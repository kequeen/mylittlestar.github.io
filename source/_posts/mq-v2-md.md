---
title: 小雨伞消息队列演化.md
date: 2019-01-23 19:42:32
tags:
---
## 前言
消息队列（Message queue，下面简称MQ）是一种进程间通信或同一进程的不同线程间的通信方式，常用于消息分发、系统解耦，流量削峰填谷等方面，是大型分布式系统不可或缺的中间件。
消息队列有两种模型，点对点和发布/订阅模型。小雨伞发展初期，只使用了点对点模型就满足了我们的需求，而随着业务的发展，原有的点对点模型越来越难以支撑业务的发展，增加发布订阅模型的事情也提上了日程。


### 消息队列1.0
我们初期只采用了消息队列的点对点模型。原因如下：
- 业务模型相对比较简单，点对点已经满足需求
- redis 实现的发布/订阅模型，我们机器实验发现其不够稳定

业务发展初期，小雨伞的消息队列的使用场景主要于以下方面：
- 支付完成异步通知出单
- 出单系统將消息分发下去，分发给每个保险公司的独立的出单进程进行处理
- 邮件的异步发送
- 订单系统通知触达系统给用户发送触达
上面的业务需求都是单系统-单系统之间的交互，或者是系统内部进行消息分发，只是用点对点模型已经可以满足其要求

redis 的高


小雨伞原有消息队列底层是使用redis的list数据结构来实现的，通过rpush与lpop操作实现消息的入栈与出栈。
消息队列1.0优点：
1. 实现简单
2. 调用方便
但是随着业务的增长，消息队列1.0在功能和管理上越来越难以满足我们的业务需求。

